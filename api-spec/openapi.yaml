openapi: 3.0.0
info:
  title: AGORA Simcluster Feedback Hub API
  description: Backend API for the community feedback management platform
  version: 1.0.0
  contact:
    name: Agora Team

servers:
  - url: http://localhost:3001/api
    description: Local development server
  - url: https://api.agora.example.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Feedback
    description: Feedback submission, retrieval, and management
  - name: Comments
    description: Comments on feedback items
  - name: Users
    description: User profiles and statistics
  - name: Communities
    description: Community management and discovery
  - name: Reports
    description: Player behavior reports and moderation

components:
  schemas:
    # ========== Common Schemas ==========
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code identifier
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details

    PaginatedResponse:
      type: object
      required:
        - data
        - total
        - page
        - pageSize
      properties:
        data:
          type: array
          items: {}
        total:
          type: integer
          description: Total number of items
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page

    # ========== Authentication Schemas ==========
    AuthRequest:
      type: object
      required:
        - provider
      properties:
        provider:
          type: string
          enum: [simcluster, discord]
          description: OAuth provider to authenticate with

    AuthResponse:
      type: object
      required:
        - token
        - refreshToken
        - user
      properties:
        token:
          type: string
          description: JWT access token
        refreshToken:
          type: string
          description: Token to refresh the access token
        user:
          $ref: '#/components/schemas/User'

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: Refresh token to exchange for new access token

    # ========== User Schemas ==========
    User:
      type: object
      required:
        - id
        - username
        - xp
        - clout
        - rank
      properties:
        id:
          type: string
          description: Unique user identifier
        username:
          type: string
          description: User's display name
        email:
          type: string
          format: email
          description: User's email address
        avatar:
          type: string
          format: uri
          description: URL to user's avatar image
        bio:
          type: string
          description: User's biography
        xp:
          type: integer
          description: Total experience points
        xpToNextLevel:
          type: integer
          description: XP needed to reach next level
        clout:
          type: integer
          description: User's clout score (community reputation)
        rank:
          type: integer
          description: User's numerical rank
        totalFeedback:
          type: integer
          description: Total feedback items submitted
        totalComments:
          type: integer
          description: Total comments made
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
        isDeveloper:
          type: boolean
          description: Whether user is a developer with special permissions
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp

    Achievement:
      type: object
      required:
        - id
        - name
        - icon
        - earned
      properties:
        id:
          type: string
          description: Unique achievement identifier
        name:
          type: string
          description: Achievement display name
        description:
          type: string
          description: Achievement description
        icon:
          type: string
          format: uri
          description: URL to achievement icon
        earned:
          type: boolean
          description: Whether user has earned this achievement
        earnedAt:
          type: string
          format: date-time
          description: Timestamp when achievement was earned (if applicable)

    UserActivity:
      type: object
      required:
        - id
        - type
        - title
        - xp
        - date
      properties:
        id:
          type: string
          description: Unique activity identifier
        type:
          type: string
          enum: [feedback, comment, upvote, achievement]
          description: Type of activity
        title:
          type: string
          description: Activity description
        xp:
          type: integer
          description: XP earned from this activity
        date:
          type: string
          format: date-time
          description: When the activity occurred

    UserProfile:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            activity:
              type: array
              items:
                $ref: '#/components/schemas/UserActivity'
              description: Recent user activity (newest first)

    # ========== Feedback Schemas ==========
    Feedback:
      type: object
      required:
        - id
        - title
        - description
        - author
        - status
        - category
        - sentiment
        - upvotes
        - commentCount
        - createdAt
      properties:
        id:
          type: string
          description: Unique feedback identifier
        title:
          type: string
          description: Feedback title
        description:
          type: string
          description: Detailed feedback description
        author:
          $ref: '#/components/schemas/User'
        status:
          type: string
          enum: [pending, acknowledged, in-progress, completed]
          description: Current feedback status
        category:
          type: string
          enum: [Feature, Bug, QoL, Balance]
          description: Feedback category
        sentiment:
          type: string
          enum: [positive, neutral, negative]
          description: Sentiment classification
        tags:
          type: array
          items:
            type: string
          description: Optional tags for categorization
        upvotes:
          type: integer
          description: Total upvotes received
        downvotes:
          type: integer
          description: Total downvotes received
        commentCount:
          type: integer
          description: Total number of comments
        xpEarned:
          type: integer
          description: XP earned from this feedback
        createdAt:
          type: string
          format: date-time
          description: When feedback was created
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
        developmentResponse:
          type: string
          description: Optional developer response to the feedback
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'
          description: Attached media/files

    FeedbackCreateRequest:
      type: object
      required:
        - title
        - description
        - category
      properties:
        title:
          type: string
          minLength: 5
          maxLength: 200
          description: Feedback title
        description:
          type: string
          minLength: 10
          maxLength: 5000
          description: Detailed description
        category:
          type: string
          enum: [Feature, Bug, QoL, Balance]
          description: Feedback category
        tags:
          type: array
          items:
            type: string
          maxItems: 5
          description: Optional tags
        attachmentIds:
          type: array
          items:
            type: string
          description: IDs of pre-uploaded attachments

    FeedbackUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 5
          maxLength: 200
        description:
          type: string
          minLength: 10
          maxLength: 5000
        category:
          type: string
          enum: [Feature, Bug, QoL, Balance]
        tags:
          type: array
          items:
            type: string
          maxItems: 5
        status:
          type: string
          enum: [pending, acknowledged, in-progress, completed]
        developmentResponse:
          type: string
          maxLength: 2000

    FeedbackListResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Feedback'

    # ========== Comment Schemas ==========
    Comment:
      type: object
      required:
        - id
        - author
        - content
        - createdAt
      properties:
        id:
          type: string
          description: Unique comment identifier
        author:
          $ref: '#/components/schemas/User'
        content:
          type: string
          description: Comment text content
        isDeveloperResponse:
          type: boolean
          description: Whether this is an official developer response
        upvotes:
          type: integer
          description: Comment upvotes
        createdAt:
          type: string
          format: date-time
          description: When comment was created
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    CommentCreateRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 1
          maxLength: 5000
          description: Comment text

    # ========== Community Schemas ==========
    Community:
      type: object
      required:
        - id
        - name
        - description
        - category
        - members
        - topicCount
      properties:
        id:
          type: string
          description: Unique community identifier
        name:
          type: string
          description: Community display name
        description:
          type: string
          description: Community description
        icon:
          type: string
          format: uri
          description: URL to community icon/logo
        category:
          type: string
          description: Community category
        members:
          type: integer
          description: Total member count
        topicCount:
          type: integer
          description: Number of topics/feedback items
        trending:
          type: boolean
          description: Whether community is trending
        createdAt:
          type: string
          format: date-time
          description: Community creation timestamp

    CommunityListResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Community'

    # ========== Report Schemas ==========
    Report:
      type: object
      required:
        - id
        - reportedUser
        - reporter
        - reason
        - status
        - createdAt
      properties:
        id:
          type: string
          description: Unique report identifier
        reportedUser:
          $ref: '#/components/schemas/User'
        reporter:
          $ref: '#/components/schemas/User'
        reason:
          type: string
          enum: [harassment, cheating, spam, inappropriate, impersonation, other]
          description: Reason for report
        description:
          type: string
          description: Detailed report description
        evidence:
          type: string
          description: Evidence or additional context
        status:
          type: string
          enum: [open, reviewing, resolved, dismissed]
          description: Report status
        moderationNotes:
          type: string
          description: Notes from moderators/admins
        createdAt:
          type: string
          format: date-time
          description: When report was created
        resolvedAt:
          type: string
          format: date-time
          description: When report was resolved

    ReportCreateRequest:
      type: object
      required:
        - reportedUsername
        - reason
      properties:
        reportedUsername:
          type: string
          description: Username of person being reported
        reason:
          type: string
          enum: [harassment, cheating, spam, inappropriate, impersonation, other]
          description: Reason for report
        customReason:
          type: string
          description: Custom reason if "other" is selected
        description:
          type: string
          maxLength: 5000
          description: Detailed description
        evidence:
          type: string
          maxLength: 2000
          description: Evidence or additional context

    ReportListResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Report'

    # ========== Attachment Schemas ==========
    Attachment:
      type: object
      required:
        - id
        - filename
        - url
        - type
      properties:
        id:
          type: string
          description: Unique attachment identifier
        filename:
          type: string
          description: Original filename
        url:
          type: string
          format: uri
          description: URL to access the attachment
        type:
          type: string
          enum: [image, video, document]
          description: Type of attachment
        size:
          type: integer
          description: File size in bytes
        uploadedAt:
          type: string
          format: date-time
          description: When file was uploaded

    # ========== Vote Schemas ==========
    VoteRequest:
      type: object
      required:
        - direction
      properties:
        direction:
          type: string
          enum: [up, down, none]
          description: Vote direction or remove vote with "none"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token

security:
  - BearerAuth: []

paths:
  # ========== AUTHENTICATION ==========
  /auth/login:
    post:
      tags:
        - Authentication
      summary: Authenticate with OAuth provider
      operationId: authLogin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        200:
          description: Successfully authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        400:
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout current user
      operationId: authLogout
      responses:
        200:
          description: Successfully logged out
        401:
          description: Not authenticated

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      operationId: authRefresh
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        200:
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        401:
          description: Refresh token invalid or expired

  # ========== USERS ==========
  /users/me:
    get:
      tags:
        - Users
      summary: Get current user's profile
      operationId: getCurrentUser
      responses:
        200:
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        401:
          description: Not authenticated

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user profile by ID
      operationId: getUserProfile
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        200:
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        404:
          description: User not found

  /users/{id}/activity:
    get:
      tags:
        - Users
      summary: Get user's recent activity
      operationId: getUserActivity
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: User activity
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserActivity'
        404:
          description: User not found

  /users/leaderboard:
    get:
      tags:
        - Users
      summary: Get user leaderboard
      operationId: getLeaderboard
      security: []
      parameters:
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [xp, clout, rank]
            default: xp
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 50
      responses:
        200:
          description: Leaderboard rankings
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'

  # ========== FEEDBACK ==========
  /feedback:
    get:
      tags:
        - Feedback
      summary: List feedback items
      operationId: listFeedback
      security: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, acknowledged, in-progress, completed]
        - name: category
          in: query
          schema:
            type: string
            enum: [Feature, Bug, QoL, Balance]
        - name: sentiment
          in: query
          schema:
            type: string
            enum: [positive, neutral, negative]
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [newest, trending, mostCommented]
            default: newest
        - name: search
          in: query
          schema:
            type: string
          description: Search in title and description
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: List of feedback items
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackListResponse'

    post:
      tags:
        - Feedback
      summary: Submit new feedback
      operationId: createFeedback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackCreateRequest'
      responses:
        201:
          description: Feedback created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Feedback'
        400:
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          description: Not authenticated

  /feedback/{id}:
    get:
      tags:
        - Feedback
      summary: Get feedback by ID
      operationId: getFeedback
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Feedback details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Feedback'
                  - type: object
                    properties:
                      comments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'
        404:
          description: Feedback not found

    patch:
      tags:
        - Feedback
      summary: Update feedback (author or admin only)
      operationId: updateFeedback
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackUpdateRequest'
      responses:
        200:
          description: Feedback updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Feedback'
        400:
          description: Invalid request
        401:
          description: Not authenticated
        403:
          description: Insufficient permissions
        404:
          description: Feedback not found

    delete:
      tags:
        - Feedback
      summary: Delete feedback (author or admin only)
      operationId: deleteFeedback
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        204:
          description: Feedback deleted
        401:
          description: Not authenticated
        403:
          description: Insufficient permissions
        404:
          description: Feedback not found

  /feedback/{id}/upvote:
    post:
      tags:
        - Feedback
      summary: Upvote or unvote feedback
      operationId: voteFeedback
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        200:
          description: Vote recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  upvotes:
                    type: integer
                  downvotes:
                    type: integer
                  userVote:
                    type: string
                    enum: [up, down, none]
        401:
          description: Not authenticated
        404:
          description: Feedback not found

  # ========== COMMENTS ==========
  /feedback/{feedbackId}/comments:
    get:
      tags:
        - Comments
      summary: Get comments for feedback
      operationId: getComments
      security: []
      parameters:
        - name: feedbackId
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: Comments list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Comment'

    post:
      tags:
        - Comments
      summary: Add comment to feedback
      operationId: createComment
      parameters:
        - name: feedbackId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreateRequest'
      responses:
        201:
          description: Comment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        400:
          description: Invalid request
        401:
          description: Not authenticated
        404:
          description: Feedback not found

  /feedback/{feedbackId}/comments/{commentId}:
    delete:
      tags:
        - Comments
      summary: Delete comment
      operationId: deleteComment
      parameters:
        - name: feedbackId
          in: path
          required: true
          schema:
            type: string
        - name: commentId
          in: path
          required: true
          schema:
            type: string
      responses:
        204:
          description: Comment deleted
        401:
          description: Not authenticated
        403:
          description: Insufficient permissions
        404:
          description: Comment not found

  /feedback/{feedbackId}/comments/{commentId}/upvote:
    post:
      tags:
        - Comments
      summary: Vote on comment
      operationId: voteComment
      parameters:
        - name: feedbackId
          in: path
          required: true
          schema:
            type: string
        - name: commentId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        200:
          description: Vote recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  upvotes:
                    type: integer
                  userVote:
                    type: string
                    enum: [up, down, none]
        401:
          description: Not authenticated
        404:
          description: Comment not found

  # ========== COMMUNITIES ==========
  /communities:
    get:
      tags:
        - Communities
      summary: List communities
      operationId: listCommunities
      security: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Search by name or description
        - name: category
          in: query
          schema:
            type: string
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [trending, newest, members]
            default: trending
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: List of communities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityListResponse'

  /communities/{id}:
    get:
      tags:
        - Communities
      summary: Get community details
      operationId: getCommunity
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Community details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Community'
                  - type: object
                    properties:
                      feedback:
                        type: array
                        items:
                          $ref: '#/components/schemas/Feedback'
        404:
          description: Community not found

  # ========== REPORTS ==========
  /reports:
    get:
      tags:
        - Reports
      summary: List reports (admin only)
      operationId: listReports
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [open, reviewing, resolved, dismissed]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 20
      responses:
        200:
          description: List of reports
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportListResponse'
        401:
          description: Not authenticated
        403:
          description: Not an admin

    post:
      tags:
        - Reports
      summary: Submit a report
      operationId: createReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportCreateRequest'
      responses:
        201:
          description: Report created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        400:
          description: Invalid request
        401:
          description: Not authenticated

  /reports/{id}:
    get:
      tags:
        - Reports
      summary: Get report details (admin only)
      operationId: getReport
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: Report details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        401:
          description: Not authenticated
        403:
          description: Not an admin
        404:
          description: Report not found

    patch:
      tags:
        - Reports
      summary: Update report status (admin only)
      operationId: updateReport
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [open, reviewing, resolved, dismissed]
                moderationNotes:
                  type: string
      responses:
        200:
          description: Report updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        401:
          description: Not authenticated
        403:
          description: Not an admin
        404:
          description: Report not found